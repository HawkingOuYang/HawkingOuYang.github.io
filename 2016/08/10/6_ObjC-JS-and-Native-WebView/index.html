<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="iOS,">





  <link rel="alternate" href="/atom.xml" title="Tech. Memo" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/img/ico1.ico?v=5.0.1">






<meta name="description" content="文章出处，原创于 https://HawkingOuYang.github.io/
我的GitHub

Native + WebView
APICloud
微信、QQ、支付宝

观点来源：http://blog.csdn.net/skymingst/article/details/44968143
优点： 

最稳定的Hybrid App开发方式，交互层的效率上由Native的东西解决了，而且架构">
<meta property="og:type" content="article">
<meta property="og:title" content="ObjC与JS交互的Native+WebView开发">
<meta property="og:url" content="https://HawkingOuYang.github.io/2016/08/10/6_ObjC-JS-and-Native-WebView/index.html">
<meta property="og:site_name" content="Tech. Memo">
<meta property="og:description" content="文章出处，原创于 https://HawkingOuYang.github.io/
我的GitHub

Native + WebView
APICloud
微信、QQ、支付宝

观点来源：http://blog.csdn.net/skymingst/article/details/44968143
优点： 

最稳定的Hybrid App开发方式，交互层的效率上由Native的东西解决了，而且架构">
<meta property="og:updated_time" content="2019-01-17T03:35:19.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ObjC与JS交互的Native+WebView开发">
<meta name="twitter:description" content="文章出处，原创于 https://HawkingOuYang.github.io/
我的GitHub

Native + WebView
APICloud
微信、QQ、支付宝

观点来源：http://blog.csdn.net/skymingst/article/details/44968143
优点： 

最稳定的Hybrid App开发方式，交互层的效率上由Native的东西解决了，而且架构">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://HawkingOuYang.github.io/2016/08/10/6_ObjC-JS-and-Native-WebView/">

  <title> ObjC与JS交互的Native+WebView开发 | Tech. Memo </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?88ba182830f261362f8368804c0b8a56";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Tech. Memo</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">stay hungry, stay foolish.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                ObjC与JS交互的Native+WebView开发
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-10T00:00:00+08:00" content="2016-08-10">
              2016-08-10
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/10/6_ObjC-JS-and-Native-WebView/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/10/6_ObjC-JS-and-Native-WebView/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
              &nbsp; | &nbsp;
              <span class="page-pv"><i class="fa fa-file-o"></i>
              <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
              </span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>文章出处，原创于 <a href="https://HawkingOuYang.github.io/">https://HawkingOuYang.github.io/</a></p>
<p><a href="https://github.com/HawkingOuYang/" target="_blank" rel="external">我的GitHub</a></p>
<hr>
<h3 id="Native-WebView"><a href="#Native-WebView" class="headerlink" title="Native + WebView"></a>Native + WebView</h3><ul>
<li>APICloud</li>
<li>微信、QQ、支付宝</li>
</ul>
<p>观点来源：<br><a href="http://blog.csdn.net/skymingst/article/details/44968143" target="_blank" rel="external">http://blog.csdn.net/skymingst/article/details/44968143</a></p>
<p>优点： </p>
<ul>
<li>最稳定的Hybrid App开发方式，交互层的效率上由Native的东西解决了，而且架构上基本就是在App内写网页，连App Store都是采用了该种方案； </li>
<li>开发时分工非常明确，底层的由iOS开发人员处理，上层的由Web前端开发人员处理； </li>
<li>有效的在线参数配置方式，以便于及时在线替换界面；</li>
</ul>
<p>缺点： </p>
<ul>
<li>团队至少需要三个工程师，一个是Web的，一个是iOS、Android的 </li>
<li>运行效率的权衡权衡，多少界面采用Web来渲染，毕竟WebView的效率会相对降低</li>
</ul>
<p>态度： </p>
<ul>
<li><a href="http://onevcat.com/2015/03/cross-platform/" target="_blank" rel="external">王巍：跨平台开发时代的 (再次) 到来？</a>    </li>
<li><a href="http://www.infoq.com/cn/articles/hybrid-app-development-combat" target="_blank" rel="external">李秉骏:Hybrid App开发实战</a></li>
</ul>
<p>另参考：</p>
<p>JS与iOS Native Code互调的优雅实现方案 (开源库的详细实现过程)<br><a href="http://blog.csdn.net/xunyn/article/details/8802584" target="_blank" rel="external">http://blog.csdn.net/xunyn/article/details/8802584</a><br>或者<br><a href="http://blog.csdn.net/yanghua_kobe/article/details/8209751" target="_blank" rel="external">http://blog.csdn.net/yanghua_kobe/article/details/8209751</a></p>
<hr>
<p>原材料：</p>
<p><a href="https://github.com/marcuswestin/WebViewJavascriptBridge" target="_blank" rel="external">WebViewJavascriptBridge</a> 桥接ObjC与JS间的通信</p>
<p><a href="https://github.com/ninjinkun/NJKWebViewProgress" target="_blank" rel="external">NJKWebViewProgress</a> 网页进度条</p>
<p><a href="https://github.com/marcuswestin/WebViewProxy" target="_blank" rel="external">WebViewProxy</a> 网页代理</p>
<hr>
<h4 id="第一部分：WebViewJavascriptBridge"><a href="#第一部分：WebViewJavascriptBridge" class="headerlink" title="第一部分：WebViewJavascriptBridge"></a>第一部分：WebViewJavascriptBridge</h4><p>GitHub上WebViewJavascriptBridge开源库的作者分别从ObjC和JS，来说怎么使用，即：Ta是分开来说。<br><a href="https://github.com/marcuswestin/WebViewJavascriptBridge" target="_blank" rel="external">https://github.com/marcuswestin/WebViewJavascriptBridge</a></p>
<p>我从ObjC与JS对应的相通点，来说怎么使用，即：我是一起来说。</p>
<p>WARNING: WKWebView still has <a href="https://github.com/ShingoFukuyama/WKWebViewTips/blob/master/README.md" target="_blank" rel="external">many bugs and missing network APIs</a>. It may not be a simple drop-in replacement.<br>WebViewJavascriptBridge supports <a href="http://nshipster.com/wkwebkit/" target="_blank" rel="external">WKWebView</a> for iOS 8 and OSX Yosemite. In order to use WKWebView you need to instantiate the WKWebViewJavascriptBridge. The rest of the WKWebViewJavascriptBridge<br> API is the same as WebViewJavascriptBridge. 对于WKWebView，为了安全起见，使用iOS自带的API。以下说明 UIWebView如何应用WebViewJavascriptBridge。</p>
<p>关键点：</p>
<h5 id="一-WebViewJavascriptBridge-js-txt-注入web-view-在JS那边创建bridge"><a href="#一-WebViewJavascriptBridge-js-txt-注入web-view-在JS那边创建bridge" class="headerlink" title="(一)  WebViewJavascriptBridge.js.txt 注入web-view, 在JS那边创建bridge."></a>(一)  WebViewJavascriptBridge.js.txt 注入web-view, 在JS那边创建bridge.</h5><p>这里，WebViewJavascriptBridge开源库已经帮我们实现了，所以我们不用关心。<br>说明：WebViewJavascriptBridge requires WebViewJavascriptBridge.js.txt file that is injected into web view to create a bridge on JS side. </p>
<h5 id="二-桥有两端，一端连接ObjC，另一端连接JS。怎么连接？"><a href="#二-桥有两端，一端连接ObjC，另一端连接JS。怎么连接？" class="headerlink" title="(二)  桥有两端，一端连接ObjC，另一端连接JS。怎么连接？"></a>(二)  桥有两端，一端连接ObjC，另一端连接JS。怎么连接？</h5><p>一端连接ObjC ——— 这里，在iOS端实现。<br><figure class="highlight scheme"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[<span class="name">WebViewJavascriptBridge</span> bridgeForWebView:webView webViewDelegate:self 	</div><div class="line">								  handler:^(<span class="name">id</span> data, WVJBResponseCallback responseCallback) &#123;</div><div class="line">    NSLog(<span class="name">@</span><span class="string">"Received message from javascript: %@"</span>, data)<span class="comment">;</span></div><div class="line">    responseCallback(<span class="name">@</span><span class="string">"Right back atcha"</span>)<span class="comment">;</span></div><div class="line">&#125;]<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>说明：Optionally, pass in webViewDelegate:(UIWebViewDelegate*)webViewDelegate if you need to respond to the web view’s lifecycle events.<br>The WVJBResponseCallback will not be nil if the javascript expects a response.</p>
<p>另一端连接JS ——— 这里，在web端实现代码，或者 在iOS端 把这个脚本注入webview.<br>怎么注入脚本？</p>
<p>对于WKWebView使用<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[[<span class="built_in">WKUserScript</span> alloc] initWithSource: <span class="keyword">self</span>.jsString</div><div class="line">injectionTime: <span class="built_in">WKUserScriptInjectionTimeAtDocumentEnd</span></div><div class="line">forMainFrameOnly: <span class="literal">YES</span>];</div></pre></td></tr></table></figure></p>
<p>对于UIWebView使用<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="section">[webView stringByEvaluatingJavaScriptFromString: self.jsString]</span><span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>说明：创建了一个 connectWebViewJavascriptBridge 方法，该方法名是固定的, (iOS7 UIWebView) －－－ 这里，要么 在web端代码实现，要么 在iOS端注入脚本到web-view，总之，二选一。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">connectWebViewJavascriptBridge</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.WebViewJavascriptBridge) &#123;</div><div class="line">        callback(WebViewJavascriptBridge)</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">document</span>.addEventListener(<span class="string">'WebViewJavascriptBridgeReady'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            callback(WebViewJavascriptBridge)</div><div class="line">        &#125;, <span class="literal">false</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">connectWebViewJavascriptBridge(<span class="function"><span class="keyword">function</span>(<span class="params">bridge</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/* Init your app here */</span></div><div class="line"></div><div class="line">    bridge.init(<span class="function"><span class="keyword">function</span>(<span class="params">message, responseCallback</span>) </span>&#123;</div><div class="line">        alert(<span class="string">'Received message: '</span> + message)   </div><div class="line">        <span class="keyword">if</span> (responseCallback) &#123;</div><div class="line">            responseCallback(<span class="string">"Right back atcha"</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;)</div><div class="line">    bridge.send(<span class="string">'Hello from the javascript'</span>)</div><div class="line">    bridge.send(<span class="string">'Please respond to this'</span>, <span class="function"><span class="keyword">function</span> <span class="title">responseCallback</span>(<span class="params">responseData</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"Javascript got its response"</span>, responseData)</div><div class="line">    &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h5 id="三-桥，建立起来之后。ObjC-与-JS-通信。"><a href="#三-桥，建立起来之后。ObjC-与-JS-通信。" class="headerlink" title="(三)  桥，建立起来之后。ObjC 与 JS 通信。"></a>(三)  桥，建立起来之后。ObjC 与 JS 通信。</h5><p>ObjC 发消息给 JS：<br><figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[bridge send:(<span class="name">id</span>)data]</div><div class="line">[bridge send:(<span class="name">id</span>)data responseCallback:(<span class="name">WVJBResponseCallback</span>)responseCallback]</div></pre></td></tr></table></figure></p>
<p>说明：Send a message to javascript. Optionally expect a response by giving a responseCallback block.</p>
<p>例如：<br><figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[self.bridge send:@<span class="string">"Hi"</span>]<span class="comment">;</span></div><div class="line">[self.bridge send:[NSDictionary dictionaryWithObject:@<span class="string">"Foo"</span> forKey:@<span class="string">"Bar"</span>]]<span class="comment">;</span></div><div class="line">[self.bridge send:@<span class="string">"I expect a response!"</span> responseCallback:^(<span class="name">id</span> responseData) &#123;</div><div class="line">    NSLog(@<span class="string">"Got response! %@"</span>, responseData)<span class="comment">;</span></div><div class="line">&#125;]<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>JS 发消息给 ObjC：<br><figure class="highlight haskell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="title">bridge</span>.send(&#123; <span class="type">Foo</span>:<span class="string">"Bar"</span> &#125;)</div><div class="line"><span class="title">bridge</span>.send(<span class="class"><span class="keyword">data</span>, function responseCallback(<span class="title">responseData</span>) &#123; ... &#125;)</span></div></pre></td></tr></table></figure></p>
<p>说明：Send a message to ObjC. Optionally expect a response by giving a responseCallback function.</p>
<p>例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">bridge.send(<span class="string">"Hi there!"</span>)</div><div class="line">bridge.send(<span class="string">"Hi there!"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">responseData</span>) </span>&#123;</div><div class="line">    alert(<span class="string">"I got a response! "</span>+<span class="built_in">JSON</span>.stringify(responseData))</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h5 id="四-桥，建立起来之后。ObjC-与-JS-调用对方代码。"><a href="#四-桥，建立起来之后。ObjC-与-JS-调用对方代码。" class="headerlink" title="(四)  桥，建立起来之后。ObjC 与 JS 调用对方代码。"></a>(四)  桥，建立起来之后。ObjC 与 JS 调用对方代码。</h5><p>ObjC调用 JS代码：<br>首先，JS准备好代码，怎么准备？如下：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bridge.registerHandler(<span class="string">"handlerName"</span>, <span class="function"><span class="keyword">function</span><span class="params">(responseData)</span> </span>&#123; ... &#125;)</div></pre></td></tr></table></figure></p>
<p>说明：Register a handler called handlerName.</p>
<p>例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">bridge.registerHandler(<span class="string">"showAlert"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123; alert(data) &#125;)</div><div class="line">bridge.registerHandler(<span class="string">"getCurrentPageUrl"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data, responseCallback</span>) </span>&#123;</div><div class="line">    responseCallback(<span class="built_in">document</span>.location.toString())</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>然后，ObjC调用 JS代码，怎么调用？如下：<br><figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[bridge callHandler:(<span class="name">NSString*</span>)handlerName data:(<span class="name">id</span>)data]</div><div class="line">[bridge callHandler:(<span class="name">NSString*</span>)handlerName data:(<span class="name">id</span>)data responseCallback:(<span class="name">WVJBResponseCallback</span>)callback]</div></pre></td></tr></table></figure></p>
<p>说明：Call the javascript handler called handlerName. Optionally expect a response by giving a responseCallback block.</p>
<p>JS调用 ObjC代码：<br>首先，ObjC准备好代码，怎么准备？如下：<br><figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[bridge registerHandler:(<span class="name">NSString*</span>)handlerName handler:(<span class="name">WVJBHandler</span>)handler]</div></pre></td></tr></table></figure></p>
<p>说明：Register a handler called handlerName.<br>例如：<br><figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[self.bridge registerHandler:@<span class="string">"getScreenHeight"</span> handler:^(<span class="name">id</span> data, WVJBResponseCallback responseCallback) &#123;</div><div class="line">    responseCallback([NSNumber numberWithInt:[UIScreen mainScreen].bounds.size.height])<span class="comment">;</span></div><div class="line">&#125;]<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>然后，JS调用 ObjC代码，怎么调用？如下：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">WebViewJavascriptBridge<span class="selector-class">.callHandler</span>(<span class="string">"handlerName"</span>)</div></pre></td></tr></table></figure></p>
<hr>
<h5 id="五-Javascript-API-特别说明："><a href="#五-Javascript-API-特别说明：" class="headerlink" title="(五) Javascript API 特别说明："></a>(五) Javascript API 特别说明：</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'WebViewJavascriptBridgeReady'</span>, <span class="function"><span class="keyword">function</span> <span class="title">onBridgeReady</span>(<span class="params">event</span>) </span>&#123; ... &#125;, <span class="literal">false</span>)</div></pre></td></tr></table></figure>
<p>说明：Always wait for the WebViewJavascriptBridgeReady DOM event.</p>
<p>例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'WebViewJavascriptBridgeReady'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> bridge = event.bridge</div><div class="line">    <span class="comment">// Start using the bridge</span></div><div class="line">&#125;, <span class="literal">false</span>)</div><div class="line"></div><div class="line">bridge.init(<span class="function"><span class="keyword">function</span> <span class="title">messageHandler</span>(<span class="params">data, response</span>) </span>&#123; ... &#125;)</div></pre></td></tr></table></figure></p>
<p>说明：Initialize the bridge. This should be called inside of the ‘WebViewJavascriptBridgeReady’ event handler.</p>
<p>特别注意：The messageHandler function will receive all messages sent from ObjC via<br><figure class="highlight scheme"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="name">bridge</span> send:(<span class="name">id</span>)data] and [<span class="name">bridge</span> send:(<span class="name">id</span>)data responseCallback:(<span class="name">WVJBResponseCallback</span>)responseCallback]</div></pre></td></tr></table></figure></p>
<p>The response object will be defined if if ObjC sent the message with a WVJBResponseCallback block.<br>例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">bridge.init(<span class="function"><span class="keyword">function</span>(<span class="params">data, responseCallback</span>) </span>&#123;</div><div class="line">    alert(<span class="string">"Got data "</span> + <span class="built_in">JSON</span>.stringify(data))</div><div class="line">    <span class="keyword">if</span> (responseCallback) &#123;</div><div class="line">        responseCallback(<span class="string">"Right back atcha!"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>每次JS收到消息时，都会调用 messageHandler，<br>所以一般messageHandler不实现任何逻辑，基本就是打印消息。当然，特殊情况，另说。</p>
<p>同理，并且经过验证 可得出：ObjC 在实例化bridge时，即<br><figure class="highlight scheme"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[<span class="name">WebViewJavascriptBridge</span> bridgeForWebView:webView webViewDelegate:self handler:^(<span class="name">id</span> data, WVJBResponseCallback responseCallback) &#123;</div><div class="line">    NSLog(<span class="name">@</span><span class="string">"Received message from javascript: %@"</span>, data)<span class="comment">;</span></div><div class="line">    responseCallback(<span class="name">@</span><span class="string">"Right back atcha"</span>)<span class="comment">;</span></div><div class="line">&#125;]<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>每次ObjC收到消息时， 都会调用handler，所以一般handler不实现任何逻辑，基本就是NSLog打印消息。当然，特殊情况，另说。</p>
<hr>
<h4 id="第二部分：NJKWebViewProgress"><a href="#第二部分：NJKWebViewProgress" class="headerlink" title="第二部分：NJKWebViewProgress"></a>第二部分：NJKWebViewProgress</h4><p>内置app浏览器(In-App browser)，效果和safari进度条一样，详见：<a href="https://github.com/ninjinkun/NJKWebViewProgress" target="_blank" rel="external">NJKWebViewProgress</a><br>NJKWebViewProgress is a progress interface library for UIWebView. Currently, UIWebView doesn’t have official progress interface. You can implement progress bar for your in-app browser using this module.<br>NJKWebViewProgress doesn’t use CocoaTouch’s private methods. It’s AppStore safe.</p>
<hr>
<h4 id="第三部分：参考资料"><a href="#第三部分：参考资料" class="headerlink" title="第三部分：参考资料"></a>第三部分：参考资料</h4><h5 id="参考资料JS："><a href="#参考资料JS：" class="headerlink" title="参考资料JS："></a>参考资料JS：</h5><p>(一)  JS事件监听<br><a href="http://www.w3schools.com/jsref/met_document_addeventlistener.asp" target="_blank" rel="external">http://www.w3schools.com/jsref/met_document_addeventlistener.asp</a></p>
<p>HTML DOM addEventListener() Method<br>Example<br>Attach a click event to the document. When the user clicks anywhere in the document, output “Hello World” in a </p><p> element with id=”demo”:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"demo"</span>).innerHTML = <span class="string">"Hello World"</span>;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>Definition and Usage</p>
<p>The document.addEventListener() method attaches an event handler to the document.</p>
<p>Tip: Use the <a href="http://www.w3schools.com/jsref/met_document_removeeventlistener.asp" target="_blank" rel="external">document.removeEventListener()</a> method to remove an event handler that has been attached with the addEventListener() method.</p>
<p>Tip: Use the <a href="http://www.w3schools.com/jsref/met_element_addeventlistener.asp" target="_blank" rel="external">element.addEventListener()</a> method to attach an event handler to a specified element.</p>
<p>Syntax<br>document.addEventListener(event, function, useCapture)</p>
<p>Parameter Values<br>Parameter<br>Description<br>event<br>Required. A String that specifies the name of the event.</p>
<p>Note: Do not use the “on” prefix. For example, use “click” instead of “onclick”.</p>
<p>For a list of all HTML DOM events, look at our complete <a href="http://www.w3schools.com/jsref/dom_obj_event.asp" target="_blank" rel="external">HTML DOM Event Object Reference</a>.<br>function<br>Required. Specifies the function to run when the event occurs. </p>
<p>When the event occurs, an event object is passed to the function as the first parameter. The type of the event object depends on the specified event. For example, the “click” event belongs to the MouseEvent object.<br>useCapture<br>Optional. A Boolean value that specifies whether the event should be executed in the capturing or in the bubbling phase. </p>
<p>Possible values:<br>    •    true - The event handler is executed in the capturing phase<br>    •    false- Default. The event handler is executed in the bubbling phase</p>
<p>Technical Details<br>DOM Version:<br>DOM Level 2 Events<br>Return Value:<br>No return value<br>Changelog:<br>The useCapture parameter became optional in Firefox 6 and Opera 11.60 (has always been optional for Chrome, IE and Safari)</p>
<p>More Examples<br>Example<br>You can also refer to an external “named” function:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"click"</span>, myFunction);</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunction</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"demo"</span>).innerHTML = <span class="string">"Hello World"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="参考资料JS-OC-通过WKWebView和WebKit-JS与OC交互。"><a href="#参考资料JS-OC-通过WKWebView和WebKit-JS与OC交互。" class="headerlink" title="参考资料JS-OC: 通过WKWebView和WebKit, JS与OC交互。"></a>参考资料JS-OC: 通过WKWebView和WebKit, JS与OC交互。</h5><p>步骤1:<br>[JavaScript synchronous native communication to WKWebView]<br>(<a href="http://stackoverflow.com/questions/26851630/javascript-synchronous-native-communication-to-wkwebview" target="_blank" rel="external">http://stackoverflow.com/questions/26851630/javascript-synchronous-native-communication-to-wkwebview</a>)</p>
<p>步骤2:<br>[WKWebView evaluateJavascript return value]<br>(<a href="http://stackoverflow.com/questions/26778955/wkwebview-evaluatejavascript-return-value" target="_blank" rel="external">http://stackoverflow.com/questions/26778955/wkwebview-evaluatejavascript-return-value</a>)</p>
<p>步骤3:<br>[WKWebView: trying to query javascript synchronously from the main thread]<br>(<a href="http://stackoverflow.com/questions/28388197/wkwebview-trying-to-query-javascript-synchronously-from-the-main-thread" target="_blank" rel="external">http://stackoverflow.com/questions/28388197/wkwebview-trying-to-query-javascript-synchronously-from-the-main-thread</a>)</p>
<p>步骤4:<br>[How do I wait for an asynchronously dispatched block to finish?]<br>(<a href="http://stackoverflow.com/questions/4326350/how-do-i-wait-for-an-asynchronously-dispatched-block-to-finish/4326754#4326754" target="_blank" rel="external">http://stackoverflow.com/questions/4326350/how-do-i-wait-for-an-asynchronously-dispatched-block-to-finish/4326754#4326754</a>)</p>
<p>步骤5:<br>[How to dispatch on main queue synchronously without a deadlock?]<br>(<a href="http://stackoverflow.com/questions/10330679/how-to-dispatch-on-main-queue-synchronously-without-a-deadlock" target="_blank" rel="external">http://stackoverflow.com/questions/10330679/how-to-dispatch-on-main-queue-synchronously-without-a-deadlock</a>)</p>
<h5 id="参考资料-WKWebView"><a href="#参考资料-WKWebView" class="headerlink" title="参考资料: WKWebView"></a>参考资料: WKWebView</h5><p>[Suppress WKWebView from scaling content to render at same magnification as UIWebView does]<br>(<a href="http://stackoverflow.com/questions/26102908/suppress-wkwebview-from-scaling-content-to-render-at-same-magnification-as-uiweb" target="_blank" rel="external">http://stackoverflow.com/questions/26102908/suppress-wkwebview-from-scaling-content-to-render-at-same-magnification-as-uiweb</a>)</p>
<p>[How to determine the content size of a WKWebView?]<br>(<a href="http://stackoverflow.com/questions/27515236/how-to-determine-the-content-size-of-a-wkwebview" target="_blank" rel="external">http://stackoverflow.com/questions/27515236/how-to-determine-the-content-size-of-a-wkwebview</a>)</p>
<p>[A Look at the WebKit Framework in iOS 8]<br>(<a href="http://www.appcoda.com/webkit-framework-tutorial/" target="_blank" rel="external">http://www.appcoda.com/webkit-framework-tutorial/</a>)</p>
<p>[WKWebView的使用心得]<br>(<a href="http://blog.csdn.net/qiang522235670/article/details/44857159" target="_blank" rel="external">http://blog.csdn.net/qiang522235670/article/details/44857159</a>)</p>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS/" rel="tag">#iOS</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/07/12/9_iOS-Study-Lectures-Docs/" rel="next" title="iOS公开课＋学习资料">
                <i class="fa fa-chevron-left"></i> iOS公开课＋学习资料
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/09/10/7_ObjC-code-style-as-team/" rel="prev" title="iOS团队代码规范（OC版）">
                iOS团队代码规范（OC版） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/img/author.jpg" alt="HawkingOuYang">
          <p class="site-author-name" itemprop="name">HawkingOuYang</p>
          <p class="site-description motion-element" itemprop="description">WeApp Web iOS</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">43</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/HawkingOuYang" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://stackoverflow.com/users/3567356/user3567356" target="_blank" title="StackOverflow">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  StackOverflow
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:Hawking.HK@gmail.com" target="_blank" title="Email">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Email
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons">
            </a>
          </div>
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Native-WebView"><span class="nav-number">1.</span> <span class="nav-text">Native + WebView</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#第一部分：WebViewJavascriptBridge"><span class="nav-number">1.1.</span> <span class="nav-text">第一部分：WebViewJavascriptBridge</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#一-WebViewJavascriptBridge-js-txt-注入web-view-在JS那边创建bridge"><span class="nav-number">1.1.1.</span> <span class="nav-text">(一)  WebViewJavascriptBridge.js.txt 注入web-view, 在JS那边创建bridge.</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#二-桥有两端，一端连接ObjC，另一端连接JS。怎么连接？"><span class="nav-number">1.1.2.</span> <span class="nav-text">(二)  桥有两端，一端连接ObjC，另一端连接JS。怎么连接？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#三-桥，建立起来之后。ObjC-与-JS-通信。"><span class="nav-number">1.1.3.</span> <span class="nav-text">(三)  桥，建立起来之后。ObjC 与 JS 通信。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#四-桥，建立起来之后。ObjC-与-JS-调用对方代码。"><span class="nav-number">1.1.4.</span> <span class="nav-text">(四)  桥，建立起来之后。ObjC 与 JS 调用对方代码。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#五-Javascript-API-特别说明："><span class="nav-number">1.1.5.</span> <span class="nav-text">(五) Javascript API 特别说明：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第二部分：NJKWebViewProgress"><span class="nav-number">1.2.</span> <span class="nav-text">第二部分：NJKWebViewProgress</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第三部分：参考资料"><span class="nav-number">1.3.</span> <span class="nav-text">第三部分：参考资料</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#参考资料JS："><span class="nav-number">1.3.1.</span> <span class="nav-text">参考资料JS：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#参考资料JS-OC-通过WKWebView和WebKit-JS与OC交互。"><span class="nav-number">1.3.2.</span> <span class="nav-text">参考资料JS-OC: 通过WKWebView和WebKit, JS与OC交互。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#参考资料-WKWebView"><span class="nav-number">1.3.3.</span> <span class="nav-text">参考资料: WKWebView</span></a></li></ol></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">HawkingOuYang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


<!--以下3行为一条竖线和Coding Page-->
<div class="powered-by2">
    <span class="hosted-by">Hosted by
      <a href="https://pages.coding.me" style="font-weight: bold">
        Coding Pages
      </a>
    </span>
</div>

        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'HawkingOuYang';
      var disqus_identifier = '2016/08/10/6_ObjC-JS-and-Native-WebView/';
      var disqus_title = "ObjC与JS交互的Native+WebView开发";
      var disqus_url = 'https://HawkingOuYang.github.io/2016/08/10/6_ObjC-JS-and-Native-WebView/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        run_disqus_script('embed.js');
      
    </script>
  




  
  

  

  

  
<script type="text/javascript" async src="//push.zhanzhang.baidu.com/push.js">
</script>





<!--
注释代码

  背景动画
  <script type="text/javascript" src="/js/src/particle.js"></script>

  页面点击小红心
  <script type="text/javascript" src="/js/src/love.js"></script>

注释代码
-->


</body>
</html>